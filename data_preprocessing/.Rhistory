rds <- as_tibble(rds)
dim(rds)
dimnames(rds)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(Matrix)
expression_matrix <- readRDS("../data/OMIX928-99-02.rds") # not included in git
annotations <- read_csv("../data/OMIX928-24.csv", show_col_types = FALSE)
annotations <- annotations %>% select(Barcode, Celltype) %>%
filter(grepl("Erythroblast", Celltype)|
grepl("Cycling_Blood_Progenitor", Celltype)|
grepl("Macrophage", Celltype)|
grepl("Megakaryocyte_Progenitor", Celltype)|
grepl("Myeloid_Cell", Celltype)|
grepl("Blood_Progenitor", Celltype)) %>%
mutate(Celltype = replace(Celltype, grepl("Erythroblast", Celltype), "Erythroblast")) %>%
mutate(Celltype = replace(Celltype, grepl("Cycling_Blood_Progenitor", Celltype), "Cycling_Blood_Progenitor")) %>%
mutate(Celltype = replace(Celltype, grepl("Macrophage", Celltype), "Macrophage")) %>%
mutate(Celltype = replace(Celltype, grepl("Blood_Progenitor", Celltype), "Blood_Progenitor"))
expression_matrix <- expression_matrix[, annotations$Barcode]
row_sums <- rowSums(expression_matrix)
indx_genes <- which(row_sums < max(row_sums)/20)
expression_matrix <- expression_matrix[indx_genes,]
expression_matrix <- readRDS("../data/OMIX928-99-02.rds") # not included in git
annotations <- read_csv("../data/OMIX928-24.csv", show_col_types = FALSE)
annotations <- annotations %>% select(Barcode, Celltype) %>%
filter(grepl("Erythroblast", Celltype)|
grepl("Cycling_Blood_Progenitor", Celltype)|
grepl("Macrophage", Celltype)|
grepl("Megakaryocyte_Progenitor", Celltype)|
grepl("Myeloid_Cell", Celltype)|
grepl("Blood_Progenitor", Celltype)) %>%
mutate(Celltype = replace(Celltype, grepl("Erythroblast", Celltype), "Erythroblast")) %>%
mutate(Celltype = replace(Celltype, grepl("Cycling_Blood_Progenitor", Celltype), "Cycling_Blood_Progenitor")) %>%
mutate(Celltype = replace(Celltype, grepl("Macrophage", Celltype), "Macrophage")) %>%
mutate(Celltype = replace(Celltype, grepl("Blood_Progenitor", Celltype), "Blood_Progenitor"))
expression_matrix <- expression_matrix[, annotations$Barcode]
row_sums <- rowSums(expression_matrix)
indx_genes <- which(row_sums > max(row_sums)/100)
expression_matrix <- expression_matrix[indx_genes,]
saveRDS(expression_matrix, file = "../data/ATAC-Seq-filtered.rds")
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(eval = FALSE)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(Matrix)
library(umap)
library(reticulate)
use_python("C:/Program Files/WindowsApps/PythonSoftwareFoundation.Python.3.12_3.12.1008.0_x64__qbz5n2kfra8p0/python.exe")
library(tidyverse)
library(Matrix)
library(umap)
library(reticulate)
use_python("C:/Users/malce/AppData/Local/Microsoft/WindowsApps/python.exe")
library(tidyverse)
library(Matrix)
library(umap)
library(reticulate)
use_python("C:/Program Files/WindowsApps/PythonSoftwareFoundation.Python.3.12_3.12.1008.0_x64__qbz5n2kfra8p0/python3.12.exe")
ATAC_expression_matrix <- readRDS("../data/ATAC-Seq-filtered.rds")
ATAC_annnotations <- read_csv("../data/ATAC_annotations.csv", show_col_types = FALSE)
ATAC_annnotations <- read_csv("../data/ATAC_annotations.csv", show_col_types = FALSE)
custom.config <- umap.defaults
custom.config$verbose <- 1
umap <- umap(t(ATAC_expression_matrix),
config = custom.config,
method = "umap-learn")
library(tidyverse)
library(Matrix)
library(umap)
library(reticulate)
use_python("C:/Program Files/WindowsApps/PythonSoftwareFoundation.Python.3.12_3.12.1008.0_x64__qbz5n2kfra8p0/python3.12.exe")
ATAC_expression_matrix <- readRDS("../data/ATAC-Seq-filtered.rds")
ATAC_annnotations <- read_csv("../data/ATAC_annotations.csv", show_col_types = FALSE)
BiocManager::install("DESeq2")
knitr::opts_chunk$set(echo = TRUE)
library(DESeq2)
library(Matrix)
library(tidyverse)
RNA_expression_matrix <- readRDS("../data/pre_processed/RNA-Seq-filtered.rds")
RNA_expression_matrix <- RNA_expression_matrix + 1
RNA_annotations <- read_csv("../data/pre_processed/RNA_annotations.csv",show_col_types = FALSE)
dds <- DESeqDataSetFromMatrix(countData = RNA_expression_matrix,
colData = select(RNA_annotations, c("sample", "Sub_trajectory_name")),
design = ~ Sub_trajectory_name)
dea <- DESeq(dds, parallel = TRUE)
results <- results(dea)
plotMA(results)
res_df <- as_tibble(results)
View(res_df)
View(dea)
assay(vst(dds))
assay(vst(dea))
colData(dea)
rowData(dea)
View(RNA_annotations)
len(distinct(RNA_annotations$Sub_trajectory_name)
)
length(distinct(RNA_annotations$Sub_trajectory_name))
length(distinct(factor(RNA_annotations$Sub_trajectory_name)))
length(distinct(factor(RNA_annotations$Sub_trajectory_name)))
distinct(c('a', 'b', 'b'))
distinct(c(1,2,3,4,4))
nrow(distinct(RNA_annotations, Sub_trajectory_name))
distinct(RNA_annotations, Sub_trajectory_name)
knitr::opts_chunk$set(echo = TRUE)
expression_matrix <- readRDS("../data/unprocessed/gene_count_cleaned.RDS") # not included in git
annotations <- read_csv("../data/unprocessed/cell_annotate.csv", show_col_types = FALSE)
annotations <- annotations %>%
filter(Sub_trajectory_name %in% c("Definitive erythroid trajectory",
"White blood cell trajectory",
"primitive erythroid trajectory",
"Megakaryocyte trajectory"),
Total_mRNAs >= 400,
doublet_cluster == FALSE,
detected_doublet == FALSE)%>%
select(sample, Main_cell_type, Main_trajectory, Sub_trajectory_name)
distinct(annotations, Sub_trajectory_name)
write_csv(annotations, "../data/pre_processed/RNA_annotations.csv")
expression_matrix <- expression_matrix[,annotations$sample]
row_max <- apply(expression_matrix, 1, max)
indx_genes <- which(row_max > 10)
expression_matrix <- expression_matrix[indx_genes,]
saveRDS(expression_matrix, file = "../data/pre_processed/RNA-Seq-filtered.rds")
library(DESeq2)
library(Matrix)
library(tidyverse)
library(BiocParallel)
register(MulticoreParam(4))
library(DESeq2)
library(Matrix)
library(tidyverse)
library(BiocParallel)
register(SnowParam(4))
RNA_expression_matrix <- readRDS("../data/pre_processed/RNA-Seq-filtered.rds")
RNA_expression_matrix <- RNA_expression_matrix + 1
RNA_annotations <- read_csv("../data/pre_processed/RNA_annotations.csv",show_col_types = FALSE)
distinct(RNA_annotations, Main_trajectory)
data <- readRDS("C:/Users/malce/Downloads/OMIX928-99-01.rds")
head(data)
max(data[1,:])
max(data[1,])
max(data[25,])
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
data <- read_csv("OMIX928-24.csv")
View(data)
data <- data %>%
filter(grepl("Erythroblast", Celltype)|
grepl("Cycling_Blood_Progenitor", Celltype)|
grepl("Macrophage", Celltype)|
grepl("Megakaryocyte_Progenitor", Celltype)|
grepl("Myeloid_Cell", Celltype)|
grepl("Blood_Progenitor", Celltype))
View(data)
nrow(data)
distinct(data, sample)
distinct(data, "sample")
distinct(data$Sample)
distinct(data, "Sample")
distinct(data, Sample)
distinct(data, Sample)$Sample
for (s in distinct(data, Sample)$Sample){
print(s,":" ,nrow(filter(data, Sample == s)))
}
for (s in distinct(data, Sample)$Sample){
print(nrow(filter(data, Sample == s)))
}
for (s in distinct(data, Sample)$Sample){
print(s)
print(nrow(filter(data, Sample == s)))
}
View(data)
library(tidyverse)
data <- read_csv("OMIX928-24.csv")
dist <- distinct(data, Celltype)
View(dist)
for (s in distinct(data, Celltype)$Celltype){
print(s)
print(nrow(filter(data, Sample == s)))
}
for (s in distinct(data, Celltype)$Celltype){
print(s)
print(nrow(filter(data, Celltype == s)))
}
for (s in distinct(data, Sample)$Sample){
print(s)
print(nrow(filter(data, Sample == s)))
}
data <- filter(data, Sample == "scATAC_SpinalCord_E13_5")
for (s in distinct(data, Celltype)$Celltype){
print(s)
print(nrow(filter(data, Celltype == s)))
}
install.packages("Matrix.utils")
library(Matrix.utils)
library(Matrix)
# Create example matrices
matrix1 <- matrix(1:9, nrow=3, byrow=TRUE)
rownames(matrix1) <- c("row1", "row2", "row3")
colnames(matrix1) <- c("A", "B", "C")
matrix2 <- matrix(10:15, nrow=3, byrow=TRUE)
rownames(matrix2) <- c("row1", "row2", "row4") # Note the different row names
colnames(matrix2) <- c("D", "E")
# Join matrices by row names
joined_matrix <- join.Matrix(matrix1, matrix2, by = "row.names")
devtools::install_url("https://cran.r-project.org/src/contrib/Archive/Matrix.utils/Matrix.utils_0.9.7.tar.gz")
install.packages("devtools")
devtools::install_url("https://cran.r-project.org/src/contrib/Archive/Matrix.utils/Matrix.utils_0.9.7.tar.gz")
library(Matrix)
# Create example matrices
matrix1 <- matrix(1:9, nrow=3, byrow=TRUE)
rownames(matrix1) <- c("row1", "row2", "row3")
colnames(matrix1) <- c("A", "B", "C")
matrix2 <- matrix(10:15, nrow=3, byrow=TRUE)
rownames(matrix2) <- c("row1", "row2", "row4") # Note the different row names
colnames(matrix2) <- c("D", "E")
# Join matrices by row names
joined_matrix <- join.Matrix(matrix1, matrix2, by = "row.names")
library(Matrix.utils)
# Create example matrices
matrix1 <- matrix(1:9, nrow=3, byrow=TRUE)
rownames(matrix1) <- c("row1", "row2", "row3")
colnames(matrix1) <- c("A", "B", "C")
matrix2 <- matrix(10:15, nrow=3, byrow=TRUE)
rownames(matrix2) <- c("row1", "row2", "row4") # Note the different row names
colnames(matrix2) <- c("D", "E")
# Join matrices by row names
joined_matrix <- join.Matrix(matrix1, matrix2, by = "row.names")
library(Matrix.utils)
# Create example matrices
matrix1 <- matrix(1:9, nrow=3, byrow=TRUE)
rownames(matrix1) <- c("row1", "row2", "row3")
colnames(matrix1) <- c("A", "B", "C")
matrix2 <- matrix(10:15, nrow=3, byrow=TRUE)
rownames(matrix2) <- c("row1", "row2", "row4") # Note the different row names
colnames(matrix2) <- c("D", "E")
# Join matrices by row names
joined_matrix <- join.Matrix(matrix1, matrix2, by.x = "row.names", by.y = "row.names")
library(Matrix.utils)
# Create example matrices
matrix1 <- matrix(1:9, nrow=3, byrow=TRUE)
rownames(matrix1) <- c("row1", "row2", "row3")
colnames(matrix1) <- c("A", "B", "C")
matrix2 <- matrix(10:15, nrow=3, byrow=TRUE)
rownames(matrix2) <- c("row1", "row2", "row4") # Note the different row names
colnames(matrix2) <- c("D", "E")
# Join matrices by row names
joined_matrix <- merge(matrix1, matrix2, by = "RowNames", all = TRUE)
library(Matrix.utils)
# Create example matrices
matrix1 <- matrix(1:9, nrow=3, byrow=TRUE)
rownames(matrix1) <- c("row1", "row2", "row3")
colnames(matrix1) <- c("A", "B", "C")
matrix2 <- matrix(10:15, nrow=3, byrow=TRUE)
rownames(matrix2) <- c("row1", "row2", "row4") # Note the different row names
colnames(matrix2) <- c("D", "E")
# Join matrices by row names
joined_matrix <- merge(matrix1, matrix2, all = TRUE)
# Print the joined matrix
print(joined_matrix)
library(Matrix.utils)
# Create example matrices
matrix1 <- matrix(1:9, nrow=3, byrow=TRUE)
rownames(matrix1) <- c("row1", "row2", "row3")
colnames(matrix1) <- c("A", "B", "C")
matrix2 <- matrix(10:15, nrow=3, byrow=TRUE)
rownames(matrix2) <- c("row1", "row2", "row4") # Note the different row names
colnames(matrix2) <- c("D", "E")
# Join matrices by row names
joined_matrix <- merge(matrix1, matrix2, by.x = rownames(matrix1), by.y = rownames(matrix2) all = TRUE)
library(Matrix.utils)
# Create example matrices
matrix1 <- matrix(1:9, nrow=3, byrow=TRUE)
rownames(matrix1) <- c("row1", "row2", "row3")
colnames(matrix1) <- c("A", "B", "C")
matrix2 <- matrix(10:15, nrow=3, byrow=TRUE)
rownames(matrix2) <- c("row1", "row2", "row4") # Note the different row names
colnames(matrix2) <- c("D", "E")
# Join matrices by row names
joined_matrix <- merge(matrix1, matrix2, by.x = rownames(matrix1), by.y = rownames(matrix2), all = TRUE)
rownames(matrix1)
library(Matrix.utils)
# Create example matrices
matrix1 <- matrix(1:9, nrow=3, byrow=TRUE)
rownames(matrix1) <- c("row1", "row2", "row3")
colnames(matrix1) <- c("A", "B", "C")
matrix2 <- matrix(10:15, nrow=3, byrow=TRUE)
rownames(matrix2) <- c("row1", "row2", "row4") # Note the different row names
colnames(matrix2) <- c("D", "E")
# Join matrices by row names
joined_matrix <- merge(matrix1, matrix2, by="row.names", all = TRUE)
# Print the joined matrix
print(joined_matrix)
library(Matrix.utils)
# Create example matrices
matrix1 <- matrix(1:9, nrow=3, byrow=TRUE)
rownames(matrix1) <- c("row1", "row2", "row3")
colnames(matrix1) <- c("A", "B", "C")
matrix2 <- matrix(10:15, nrow=3, byrow=TRUE)
rownames(matrix2) <- c("row1", "row2", "row4") # Note the different row names
colnames(matrix2) <- c("D", "E")
# Join matrices by row names
joined_matrix <- merge(matrix1, matrix2, by="row.names", all = TRUE, incomparables = 0)
# Print the joined matrix
print(joined_matrix)
library(Matrix.utils)
# Create example matrices
matrix1 <- Matrix(1:9, nrow=3, byrow=TRUE, sparse = TRUE)
rownames(matrix1) <- c("row1", "row2", "row3")
colnames(matrix1) <- c("A", "B", "C")
matrix2 <- Matrix(10:15, nrow=3, byrow=TRUE, sparse = TRUE)
rownames(matrix2) <- c("row1", "row2", "row4") # Note the different row names
colnames(matrix2) <- c("D", "E")
# Join matrices by row names
joined_matrix <- merge(matrix1, matrix2, by="row.names", all = TRUE, incomparables = 0)
library(Matrix)
# Create example matrices
matrix1 <- Matrix(1:9, nrow=3, byrow=TRUE, sparse = TRUE)
rownames(matrix1) <- c("row1", "row2", "row3")
colnames(matrix1) <- c("A", "B", "C")
matrix2 <- Matrix(10:15, nrow=3, byrow=TRUE, sparse = TRUE)
rownames(matrix2) <- c("row1", "row2", "row4") # Note the different row names
colnames(matrix2) <- c("D", "E")
# Join matrices by row names
joined_matrix <- merge(matrix1, matrix2, by="row.names", all = TRUE, incomparables = 0)
library(Matrix)
# Create example matrices
matrix1 <- Matrix(1:9, nrow=3, byrow=TRUE, sparse = TRUE)
rownames(matrix1) <- c("row1", "row2", "row3")
colnames(matrix1) <- c("A", "B", "C")
matrix2 <- Matrix(10:15, nrow=3, byrow=TRUE, sparse = TRUE)
rownames(matrix2) <- c("row1", "row2", "row4") # Note the different row names
colnames(matrix2) <- c("D", "E")
# Join matrices by row names
joined_matrix <- base::merge(matrix1, matrix2, by="row.names", all = TRUE, incomparables = 0)
library(Matrix)
# Create example matrices
matrix1 <- Matrix(1:9, nrow=3, byrow=TRUE, sparse = TRUE)
rownames(matrix1) <- c("row1", "row2", "row3")
colnames(matrix1) <- c("A", "B", "C")
matrix2 <- Matrix(10:15, nrow=3, byrow=TRUE, sparse = TRUE)
rownames(matrix2) <- c("row1", "row2", "row4") # Note the different row names
colnames(matrix2) <- c("D", "E")
# Join matrices by row names
joined_matrix <- base::merge(matrix1, matrix2, by.x="row.names", by.y="row.names", all = TRUE, incomparables = 0)
library(Matrix)
# Create example matrices
matrix1 <- Matrix(1:9, nrow=3, byrow=TRUE, sparse = TRUE)
rownames(matrix1) <- c("row1", "row2", "row3")
colnames(matrix1) <- c("A", "B", "C")
matrix2 <- Matrix(10:15, nrow=3, byrow=TRUE, sparse = TRUE)
rownames(matrix2) <- c("row1", "row2", "row4") # Note the different row names
colnames(matrix2) <- c("D", "E")
# Join matrices by row names
joined_matrix <- base::merge(matrix1, matrix2, by.x="row.names", by.y="row.names")
library(Matrix)
library(GenomicRanges)
library(rtracklayer)
library(TxDb.Mmusculus.UCSC.mm10.knownGene)
library(AnnotationDbi)
library(org.Mm.eg.db)
library(readr)
library(dplyr)
library(tidyr)
library(tibble)
path = "../data/unprocessed/atac_organ_fragments/"
files <- read.table(paste(path, "md5.txt", sep = ""))$V2
setwd("F:/DS_Project/data_preprocessing")
library(Matrix)
library(GenomicRanges)
library(rtracklayer)
library(TxDb.Mmusculus.UCSC.mm10.knownGene)
library(AnnotationDbi)
library(org.Mm.eg.db)
library(readr)
library(dplyr)
library(tidyr)
library(tibble)
path = "../data/unprocessed/atac_organ_fragments/"
files <- read.table(paste(path, "md5.txt", sep = ""))$V2
genes <- genes(TxDb.Mmusculus.UCSC.mm10.knownGene)
for(file in files[20]){
fragments <- read_tsv(paste(path, file, sep = ""),
col_names = FALSE,
num_threads = 16,
show_col_types = FALSE)
print("file loaded")
atac_Granges <- GRanges(seqnames = fragments$X1,
ranges = IRanges(start = fragments$X2,
end = fragments$X3),
sample = fragments$X4)
rm(fragments)
nearest_genes <- nearest(atac_Granges, genes)
atac_Granges$gene_id <- mcols(genes)$gene_id[nearest_genes]
print("nearest genes calculated")
gene_symbols <- mapIds(org.Mm.eg.db,
keys = atac_Granges$gene_id,
column = "SYMBOL",
keytype = "ENTREZID",
multiVals = "first")
atac_Granges$gene_symbol <- gene_symbols
atac_df <- as_tibble(atac_Granges)
print("got dataframe")
rm(atac_Granges)
atac_df <- atac_df %>%
summarise(count = n(), .by = c("gene_symbol", "sample")) %>%
arrange(gene_symbol, sample) %>%
ungroup()
print(atac_df)
atac_df <- pivot_wider(atac_df, names_from = sample, values_from = count, values_fill = list(count = 0)) %>%
drop_na(gene_symbol) %>%
mutate(gene_symbol = as.character(gene_symbol)) %>%
column_to_rownames(var = "gene_symbol")
print("reshaped dataframe")
atac_matrix <- as(atac_df, "sparseMatrix")
print(paste("got matrix,", file))
saveRDS(atac_matrix, paste("../data/unprocessed/atac_organ_counts/ATAC_counts",file,".rds", sep = ""), compress = TRUE)
rm(atac_df, atac_matrix)
}
setwd("F:/DS_Project/data_preprocessing")
knitr::opts_chunk$set(echo = TRUE)
expression_matrix <- readRDS("../data/unprocessed/ATAC_counts.rds") # not included in git
annotations <- read_csv("../data/unprocessed/OMIX928-24.csv", show_col_types = FALSE)
library(tidyverse)
library(Matrix)
annotations <- read_csv("../data/unprocessed/OMIX928-24.csv", show_col_types = FALSE)
annotations <- annotations %>% select(Barcode, Celltype) %>%
filter(grepl("Erythroblast", Celltype)|
grepl("Cycling_Blood_Progenitor", Celltype)|
grepl("Macrophage", Celltype)|
grepl("Megakaryocyte_Progenitor", Celltype)|
grepl("Myeloid_Cell", Celltype)|
grepl("Blood_Progenitor", Celltype)) #%>%
#mutate(Celltype = replace(Celltype, grepl("Erythroblast", Celltype), "Erythroblast")) %>%
#mutate(Celltype = replace(Celltype, grepl("Cycling_Blood_Progenitor", Celltype), "Cycling_Blood_Progenitor")) %>%
#mutate(Celltype = replace(Celltype, grepl("Macrophage", Celltype), "Macrophage")) %>%
#mutate(Celltype = replace(Celltype, grepl("Megakaryocyte_Progenitor", Celltype), "Megakaryocyte_Progenitor")) %>%
#mutate(Celltype = replace(Celltype, grepl("Myeloid_Cell", Celltype), "Myeloid_Cell")) %>%
#mutate(Celltype = replace(Celltype, grepl("Blood_Progenitor", Celltype), "Blood_Progenitor"))
write_csv(annotations, "../data/pre_processed/ATAC_annotations.csv")
expression_matrix <- expression_matrix[, annotations$Barcode]
annotations$Barcode[1:10]
colnames(expression_matrix)[1:10]
annotations <- read_csv("../data/unprocessed/OMIX928-24.csv", show_col_types = FALSE)
annotations <- annotations %>% select(Barcode, Celltype) %>%
filter(grepl("Erythroblast", Celltype)|
grepl("Cycling_Blood_Progenitor", Celltype)|
grepl("Macrophage", Celltype)|
grepl("Megakaryocyte_Progenitor", Celltype)|
grepl("Myeloid_Cell", Celltype)|
grepl("Blood_Progenitor", Celltype)) %>%
mutate(Barcode = replace(Barcode, Barcode, sub(paste0(".*\\", "#"), "", Barcode)))
annotations <- read_csv("../data/unprocessed/OMIX928-24.csv", show_col_types = FALSE)
annotations <- annotations %>% select(Barcode, Celltype) %>%
filter(grepl("Erythroblast", Celltype)|
grepl("Cycling_Blood_Progenitor", Celltype)|
grepl("Macrophage", Celltype)|
grepl("Megakaryocyte_Progenitor", Celltype)|
grepl("Myeloid_Cell", Celltype)|
grepl("Blood_Progenitor", Celltype)) %>%
mutate(Barcode = replace(Barcode, Barcode, sub(paste0(".*\\", "#"), "", annotations$Barcode)))
sub(paste0(".*\\", "#"), "", annotations$Barcode)[1:10]
length(sub(paste0(".*\\", "#"), "", annotations$Barcode))
annotations <- annotations %>% select(Barcode, Celltype) %>%
filter(grepl("Erythroblast", Celltype)|
grepl("Cycling_Blood_Progenitor", Celltype)|
grepl("Macrophage", Celltype)|
grepl("Megakaryocyte_Progenitor", Celltype)|
grepl("Myeloid_Cell", Celltype)|
grepl("Blood_Progenitor", Celltype)) %>%
mutate(Barcode = replace(Barcode, sub(paste0(".*\\", "#"), "", annotations$Barcode)))
annotations <- annotations %>% select(Barcode, Celltype) %>%
filter(grepl("Erythroblast", Celltype)|
grepl("Cycling_Blood_Progenitor", Celltype)|
grepl("Macrophage", Celltype)|
grepl("Megakaryocyte_Progenitor", Celltype)|
grepl("Myeloid_Cell", Celltype)|
grepl("Blood_Progenitor", Celltype)) %>%
mutate(Barcode = sub(paste0(".*\\", "#"), "", annotations$Barcode))
annotations <- annotations %>% select(Barcode, Celltype) %>%
filter(grepl("Erythroblast", Celltype)|
grepl("Cycling_Blood_Progenitor", Celltype)|
grepl("Macrophage", Celltype)|
grepl("Megakaryocyte_Progenitor", Celltype)|
grepl("Myeloid_Cell", Celltype)|
grepl("Blood_Progenitor", Celltype)) %>%
mutate(Barcode = sub(paste0(".*\\", "#"), "", Barcode))
#mutate(Celltype = replace(Celltype, grepl("Erythroblast", Celltype), "Erythroblast")) %>%
#mutate(Celltype = replace(Celltype, grepl("Cycling_Blood_Progenitor", Celltype), "Cycling_Blood_Progenitor")) %>%
#mutate(Celltype = replace(Celltype, grepl("Macrophage", Celltype), "Macrophage")) %>%
#mutate(Celltype = replace(Celltype, grepl("Megakaryocyte_Progenitor", Celltype), "Megakaryocyte_Progenitor")) %>%
#mutate(Celltype = replace(Celltype, grepl("Myeloid_Cell", Celltype), "Myeloid_Cell")) %>%
#mutate(Celltype = replace(Celltype, grepl("Blood_Progenitor", Celltype), "Blood_Progenitor"))
write_csv(annotations, "../data/pre_processed/ATAC_annotations.csv")
expression_matrix <- expression_matrix[, annotations$Barcode]
row_max <- apply(expression_matrix, 1, max)
indx_genes <- which(row_max > max(row_max)/100)
expression_matrix <- expression_matrix[indx_genes,]
saveRDS(expression_matrix, file = "../data/pre_processed/ATAC-Seq-filtered.rds")
dim(expression_matrix)
row_max <- apply(expression_matrix, 1, max)
indx_genes <- which(row_max > max(row_max)/20)
expression_matrix <- expression_matrix[indx_genes,]
dim(expression_matrix)
expression_matrix <- readRDS("../data/unprocessed/ATAC_counts.rds") # not included in git
expression_matrix <- expression_matrix[, annotations$Barcode]
row_max <- apply(expression_matrix, 1, max)
indx_genes <- which(row_max > max(row_max)/50)
expression_matrix <- expression_matrix[indx_genes,]
dim(expression_matrix)
saveRDS(expression_matrix, file = "../data/pre_processed/ATAC-Seq-filtered.rds", compress = TRUE)
